{{template "layout.gohtml" .}}

{{define "sidebar"}}
<div class="sidebar">
    <div class="search-section">
        <h3>🔍 Tìm kiếm</h3>
        <form method="GET" action="/" class="search-form">
            <input type="text" name="search" placeholder="Tìm kiếm packages..."
                value="{{if .SearchQuery}}{{.SearchQuery}}{{end}}" class="search-input">
            <button type="submit" class="search-btn">Tìm</button>
        </form>
    </div>

    <div class="category-menu">
        <h3>📦 Danh mục</h3>
        <a href="/" class='category-item {{if eq .Selected ""}}active{{end}}'>
            <span class="category-icon">📋</span>
            Tất cả Packages
        </a>
        {{range $key, $category := .Categories}}
        <a href="/?category={{$key}}" class='category-item {{if eq $.Selected $key}}active{{end}}'>
            <span class="category-icon">{{$category.Icon}}</span>
            {{$category.Name}}
        </a>
        {{end}}
    </div>
</div>
{{end}}

{{define "home-content"}}
{{if .Packages}}
<div class="packages-grid">
    {{range .Packages}}
    <div class="package-card" data-category="{{.Category}}">
        <div class="package-header">
            <div class="package-info">
                <h3 class="package-path">{{.Path}}</h3>
                {{if .Category}}
                {{with index $.Categories .Category}}
                <span class="package-category" style="background-color: {{.Color}}">
                    {{.Icon}} {{.Name}}
                </span>
                {{end}}
                {{end}}
            </div>
            {{if .Version}}
            <span class="package-version">{{.Version}}</span>
            {{end}}
        </div>

        <div class="package-repo">Repository: {{.Repository}}</div>
        <div class="package-description">{{.Description}}</div>

        {{if .Tags}}
        <div class="package-tags">
            {{range .Tags}}<span class="tag">{{.}}</span>{{end}}
        </div>
        {{end}}

        {{if .Dependencies}}
        <div class="package-dependencies">
            <strong>Dependencies:</strong>
            {{range .Dependencies}}
            <a href="/{{.}}" class="dependency">{{.}}</a>
            {{end}}
        </div>
        {{end}}

        <div class="install-cmd">
            <code>go get {{.Path}}</code>
            <button class="copy-btn" data-clipboard="go get {{.Path}}">📋</button>
        </div>

        <div class="package-actions">
            <a href="/{{.Name}}" class="btn btn-primary">Chi tiết</a>
            <a href="https://{{.Repository}}" target="_blank" class="btn btn-success">GitHub</a>
            {{if .Homepage}}<a href="{{.Homepage}}" target="_blank" class="btn btn-secondary">Homepage</a>{{end}}
        </div>

        <div class="package-meta">
            {{if .Author}}<span>👤 {{.Author}}</span>{{end}}
            {{if .License}}<span>📄 {{.License}}</span>{{end}}
        </div>
    </div>
    {{end}}
</div>
{{else}}
<div class="no-packages">
    <h3>Không tìm thấy package nào</h3>
    {{if .SearchQuery}}
    <p>Không có package nào phù hợp với từ khóa "{{.SearchQuery}}"</p>
    <a href="/" class="btn btn-primary">Xem tất cả packages</a>
    {{else if .Selected}}
    <p>Không có package nào trong danh mục này.</p>
    <a href="/" class="btn btn-primary">Xem tất cả packages</a>
    {{else}}
    <p>Chưa có package nào được đăng ký.</p>
    {{end}}
</div>
{{end}}

<div class="stats-section">
    <div class="stat-item">
        <span class="stat-number">{{len .Packages}}</span>
        <span class="stat-label">Packages</span>
    </div>
    <div class="stat-item">
        <span class="stat-number">{{len .Categories}}</span>
        <span class="stat-label">Categories</span>
    </div>
</div>
{{end}}